"use strict";(self["webpackChunktoutiao_mobile"]=self["webpackChunktoutiao_mobile"]||[]).push([[870],{7870:function(t,e,s){s.r(e),s.d(e,{default:function(){return w}});var a=function(){var t=this,e=t._self._c;return e("div",[e("van-nav-bar",{scopedSlots:t._u([{key:"left",fn:function(){return[e("div",{staticClass:"logo"},[t._v("头条123")])]},proxy:!0},{key:"right",fn:function(){return[e("van-button",{attrs:{round:"",icon:"search",type:"info"},on:{click:function(e){return t.$router.push("/search")}}},[t._v("搜索")])]},proxy:!0}])}),e("van-tabs",{model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[t._l(t.myChannels,(function(t){return e("van-tab",{key:t.id,attrs:{title:t.name}},[e("keep-alive",{attrs:{include:"list"}},[e("acrticle-list",{attrs:{artId:t.id}})],1)],1)})),e("div",{staticClass:"icon-wrap"},[e("van-icon",{attrs:{name:"weapp-nav"},on:{click:function(e){return t.Show()}}})],1)],2),e("channel-edit",{ref:"cnl",attrs:{channelList:t.myChannels},on:{setList:t.setList},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}})],1)},i=[],n=s(5198),l=function(){var t=this,e=t._self._c;return e("div",{ref:"scrollRef",staticClass:"artList",on:{scroll:t.scrollEvent}},[e("van-pull-refresh",{attrs:{"success-text":"刷新成功"},on:{refresh:t.onRefresh},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了"},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(s){return e("van-cell",{key:s.art_id,on:{click:function(e){return t.$router.push("/article?id="+s.art_id)}}},[[e("div",{staticClass:"title"},[t._v(t._s(s.title))]),e("van-grid",{attrs:{border:!1,"column-num":s.cover.type}},t._l(s.cover.images,(function(t,s){return e("van-grid-item",{key:s},[e("van-image",{staticClass:"pic",attrs:{src:t}})],1)})),1),e("div",{staticClass:"other"},[e("span",[t._v(t._s(s.aut_name))]),e("span",{staticClass:"comment"},[t._v(" "+t._s(s.comm_count)+" ")]),e("span",[t._v(t._s(s.pubdate))])])]],2)})),1)],1)],1)},c=[],o={props:{artId:{type:Number,required:!0}},data(){return{list:[],loading:!1,finished:!1,timestamp:Date.now(),isLoading:!1}},methods:{async onLoad(){const t=await(0,n.P8)({channel_id:this.artId,timestamp:this.timestamp});this.list.push(...t.data.data.results),this.timestamp=t.data.data.pre_timestamp,this.loading=!1,null==this.timestamp&&(this.finished=!0)},async onRefresh(){const t=await(0,n.P8)({channel_id:this.artId,timestamp:Date.now()});this.list=t.data.data.results,this.isLoading=!1},scrollEvent(t){localStorage.setItem("srcoll",t.target.scrollTop)}},activated(){this.$refs.scrollRef.scrollTop=+localStorage.getItem("scroll")}},r=o,u=s(1001),d=(0,u.Z)(r,l,c,!1,null,"2c3d2c70",null),h=d.exports,m=function(){var t=this,e=t._self._c;return e("van-action-sheet",{attrs:{title:"频道管理"},model:{value:t.isShow,callback:function(e){t.isShow=e},expression:"isShow"}},[e("div",{staticClass:"content"},[e("div",{staticClass:"my"},[e("span",{staticClass:"my-title"},[t._v("我的频道")]),e("van-button",{staticClass:"my-btn",attrs:{type:"danger",plain:"",size:"mini"},on:{click:function(e){t.edit=!t.edit}}},[t._v(" "+t._s(t.edit?"取消":"编辑")+" ")])],1),e("van-grid",t._l(t.channelList,(function(s,a){return e("van-grid-item",{key:s.id,on:{click:function(e){return t.itemClick(a)}}},[e("span",{class:{active:t.value===a}},[t._v(t._s(s.name))]),t.edit&&"推荐"!==s.name?e("van-icon",{staticClass:"close",attrs:{name:"cross"},on:{click:function(e){return t.delItem(a)}}}):t._e()],1)})),1),e("div",{staticClass:"select"},[e("span",{staticClass:"my-title"},[t._v("可选频道")]),e("van-grid",t._l(t.newList,(function(s){return e("van-grid-item",{key:s.id,attrs:{text:s.name},on:{click:function(e){return t.selectClick(s)}}})})),1)],1)],1)])},v=[],p={props:{channelList:{type:Array,require:!0},value:{type:Number,required:!0}},data(){return{isShow:!1,edit:!1,allChannel:[]}},computed:{newList(){return this.allChannel.filter((t=>{const e=this.channelList.find((e=>e.id===t.id));return!e}))}},mounted(){this.getAlllist()},methods:{async getAlllist(){const t=await(0,n.uR)();console.log(t),this.allChannel=t.data.data.channels},itemClick(t){this.isShow=!1,this.$emit("input",t)},delItem(t){this.$emit("setList",{method:"splice",value:t}),t<this.value&&this.$emit("input",this.value-1)},selectClick(t){this.$emit("setList",{method:"push",value:t})}}},f=p,_=(0,u.Z)(f,m,v,!1,null,"04a3d5ae",null),y=_.exports,C={data(){return{myChannels:[],active:0}},async created(){if(this.$store.state.tokenObj.token){const t=await(0,n.sJ)();this.myChannels=t.data.data.channels}else{const t=JSON.parse(localStorage.getItem("list"));if(t)this.myChannels=t;else{const t=await(0,n.sJ)();this.myChannels=t.data.data.channels}}},components:{acrticleList:h,channelEdit:y},methods:{Show(){this.$refs.cnl.isShow=!0},async setList({method:t,value:e}){if("push"===t?this.myChannels.push(e):"splice"===t&&this.myChannels.splice(e,1),localStorage.setItem("list",JSON.stringify(this.myChannels)),this.$store.state.tokenObj.token){const t=this.myChannels.map(((t,e)=>({id:t.id,seq:e})));await(0,n.sp)({channels:t})}}}},g=C,k=(0,u.Z)(g,a,i,!1,null,"7a24fd30",null),w=k.exports}}]);